<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title><%= htmlWebpackPlugin.options.title %></title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164909144-2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-164909144-2');
    </script>
  </head>
  <body style="margin:0;">
    <div id="root"></div>  
    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", function(){
        var messageQueueDown = [];
        var messageQueueUp = [];
        var iFrameLoaded = false;
        // Assign handler to message event
        if ( window.addEventListener ) {
            window.addEventListener('message', handleMessage, false);
        } else if ( window.attachEvent ) { // ie8
            window.attachEvent('onmessage', handleMessage);
        }
        function handleMessage (event) {
          if(!(event.origin === "https://remotely-voice-server.australiaeast.cloudapp.azure.com" ||
          event.origin === "https://dev-remotely-server.australiaeast.cloudapp.azure.com" || 
          event.origin === "https://remotely-meeting-rooms.azurefd.net" || 
          event.origin === "https://remotely-meeting.australiaeast.cloudapp.azure.com" || 
          event.origin === "https://meetings.remotelyhq.com" || 
          event.origin === "https://prod-meeting-assets.azurefd.net" )
          ){
            return;
          }
          if(event.data && event.data.length > 0){
            if(event.data[0] == "packet"){
              if(window.connector){
                while (messageQueueUp.length > 0) {
                  window.connector.sendPacket(messageQueueUp.shift());
                }
                window.connector.sendPacket(event.data[1]);
              }else{
                messageQueueUp.push(event.data[1])
              }
            }else if(event.data[0] == "loaded"){
              iFrameLoaded=true;
              sendToIframe("","");
            }
          }
        };
        function sendToIframe(method, data){
          if(!window.gameframe){
            window.gameframe = document.getElementsByTagName("iframe")[0].contentWindow;
          }
          if(!iFrameLoaded){
            if(method.length == 0) return;
            messageQueueDown.push({'method':method,'data':data});
          }else{
            while(messageQueueDown.length > 0){
              let poped =  messageQueueDown.shift();
              window.gameframe.postMessage(JSON.stringify({'method':poped['method'],'parameters':poped['data']}),'*');
            }
            if(method.length == 0) return;
            window.gameframe.postMessage(JSON.stringify({'method':method,'parameters':data}),'*');
          }
        }
        window.sendtoiframe = sendToIframe;
      });
      
      function S4() {  
          return (((1+Math.random())*0x10000)|0).toString(16).substring(1);  
      }  
      function createGuid() {  
          return (S4() + S4() + "-" + S4() + "-4" + S4().substr(0,3) + "-" + S4() + "-" + S4() + S4() + S4()).toLowerCase();  
      } 
      function generateRoomLink(){
        return "https://meetings.remotelyhq.com/"+ createGuid();
      }
    </script>
  </body>
</html>
